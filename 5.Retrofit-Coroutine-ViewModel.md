# üìö Tuto ‚Äî Retrofit + Coroutine + ViewModel + Compose

---

## üéØ Objectif p√©dagogique

Apprendre √† utiliser **Retrofit avec Coroutine dans un ViewModel**, pour s√©parer la **logique m√©tier** de l‚Äô**interface UI** et respecter les **bonnes pratiques Android modernes**.

---

## üîß √âtapes

---

## üß± √âtape 1 : D√©pendances (`build.gradle`)

```kotlin
// Retrofit
implementation 'com.squareup.retrofit2:retrofit:2.9.0'
implementation 'com.squareup.retrofit2:converter-gson:2.9.0'

// Coroutines
implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.6.4'

// ViewModel + Compose
implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.1"
implementation "androidx.lifecycle:lifecycle-viewmodel-compose:2.6.1"
```

> üîÅ Clique sur **Sync Now**

---

## üìÅ √âtape 2 : Mod√®le de donn√©es

```kotlin
data class Todo(
    val id: Int,
    val title: String,
    val completed: Boolean
)
```

---

## üåê √âtape 3 : Interface API Retrofit

```kotlin
import retrofit2.http.GET

interface ApiService {
    @GET("todos/1")
    suspend fun getTodo(): Todo
}
```

---

## üîå √âtape 4 : Objet Retrofit

```kotlin
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

object RetrofitClient {
    val api: ApiService by lazy {
        Retrofit.Builder()
            .baseUrl("https://jsonplaceholder.typicode.com/")
            .addConverterFactory(GsonConverterFactory.create())
            .build()
            .create(ApiService::class.java)
    }
}
```

---

## üß† √âtape 5 : ViewModel avec Coroutine

```kotlin
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.launch

class TodoViewModel : ViewModel() {
    private val _todoTitle = MutableStateFlow("Chargement...")
    val todoTitle: StateFlow<String> = _todoTitle

    init {
        fetchTodo()
    }

    private fun fetchTodo() {
        viewModelScope.launch {
            try {
                val todo = RetrofitClient.api.getTodo()
                _todoTitle.value = todo.title
            } catch (e: Exception) {
                _todoTitle.value = "Erreur : ${e.message}"
            }
        }
    }
}
```

---

## üñºÔ∏è √âtape 6 : UI avec Compose et ViewModel

```kotlin
import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.foundation.layout.*
import androidx.compose.material.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import androidx.lifecycle.viewmodel.compose.viewModel

class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            TodoScreen()
        }
    }
}

@Composable
fun TodoScreen(viewModel: TodoViewModel = viewModel()) {
    val title by viewModel.todoTitle.collectAsState()

    Surface(modifier = Modifier.fillMaxSize()) {
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(24.dp),
            verticalArrangement = Arrangement.Center,
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Text(text = title, style = MaterialTheme.typography.h5)
        }
    }
}
```

---

## üîç R√©sum√© p√©dagogique

| √âl√©ment | R√¥le |
|--------|------|
| `ViewModel` | Contient la logique m√©tier, g√®re l‚Äô√©tat |
| `viewModelScope.launch` | Lance la coroutine dans un scope li√© √† la vie du ViewModel |
| `MutableStateFlow` | G√®re un √©tat observable (r√©actif) |
| `collectAsState()` | Observe les changements et met √† jour l‚ÄôUI |
| `Retrofit` | Appel HTTP GET vers l‚ÄôAPI REST |

---

## ‚úÖ Ce que tu obtiens :

- App rapide et fluide üí®  
- Code bien structur√© üß±  
- Pr√™t pour les projets r√©els üíº  

---

Souhaites-tu maintenant :

- Une version avec une **liste compl√®te de todos (`/todos`) + `LazyColumn`** ?
- Un **exercice avec ViewModel vide √† compl√©ter** pour les apprenants ?
- Ou passer √† **l‚Äôint√©gration d‚Äôun bouton de rechargement (`refresh`)** ?

Je peux te guider √† chaque √©tape !